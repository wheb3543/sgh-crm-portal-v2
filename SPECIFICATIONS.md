# المواصفات التقنية للمشروع (SGH-CRM-Portal)

**الهدف:** توفير مرجع تقني مفصل لضمان التزام جميع أعضاء الفريق بالمعايير الموحدة، خاصة أثناء عملية الترحيل (Migration) وتطوير الميزات الجديدة.

---

## 1. المرحلة صفر: التأسيس والترحيل إلى Next.js

| العنصر | المواصفات التقنية |
| :--- | :--- |
| **إطار العمل المستهدف** | Next.js (أحدث إصدار مستقر). |
| **نظام التوجيه** | App Router (للاستفادة القصوى من ميزات Next.js الحديثة). |
| **الترحيل** | نقل جميع المكونات (Components) والصفحات (Pages) من بنية `client/` الحالية إلى بنية `app/` في Next.js. |
| **العرض الهجين** | يجب أن تكون جميع الصفحات العامة (الرئيسية، العروض، الأطباء، المخيمات) قابلة للعرض كـ **Static Site Generation (SSG)** أو **Server-Side Rendering (SSR)** عند الحاجة. |
| **لوحة التحكم** | يجب أن تعمل لوحة التحكم (`/admin`) كـ **Client-Side Rendering (CSR)** أو **Server Component** مع استخدام `use client` عند الحاجة للتفاعلية. |
| **tRPC Integration** | يجب إعادة تكوين tRPC ليعمل بشكل صحيح مع Next.js App Router (يفضل استخدام `server components` لـ tRPC). |
| **البيئة** | يجب أن يعمل المشروع بشكل كامل في بيئة `pnpm` و `TypeScript`. |

---

## 2. تحديث هيكل البيانات (Drizzle ORM)

| الجدول | الحقول الجديدة/المعدلة | الغرض |
| :--- | :--- | :--- |
| **offers (جديد)** | `id`, `title`, `slug` (unique), `description`, `imageUrl`, `isActive` (boolean), `startDate`, `endDate`. | إدارة العروض التسويقية للمستشفى. |
| **leads (معدل)** | `sourceType` (enum: 'offer', 'doctor', 'camp'), `sourceId` (int). | تتبع مصدر العميل المسجل بدقة (أي عرض، أي طبيب، أي مخيم). |
| **doctors (معدل)** | `slug` (unique). | لإنشاء روابط صفحات هبوط فريدة لكل طبيب. |
| **camps (معدل)** | `slug` (unique). | لإنشاء روابط صفحات هبوط فريدة لكل مخيم. |

---

## 3. معايير الكود والجودة

| المعيار | التفاصيل |
| :--- | :--- |
| **TypeScript** | يجب أن يكون الكود خاليًا من أخطاء TypeScript (Strict Mode). |
| **ESLint/Prettier** | يجب الالتزام بقواعد التنسيق والتحقق من الجودة (Linter) المحددة في المشروع. |
| **الاختبارات** | يجب أن يصاحب كل ميزة جديدة اختبارات وحدة (Unit Tests) واختبارات تكامل (Integration Tests) باستخدام Vitest. |
| **التعليقات** | يجب إضافة تعليقات واضحة (باللغة العربية أو الإنجليزية) للوظائف المعقدة والمنطق الحساس. |

---

## 4. متطلبات النشر (CI/CD)

| العنصر | المواصفات |
| :--- | :--- |
| **CI (التكامل المستمر)** | يجب أن يقوم GitHub Actions بتشغيل `pnpm install`، `pnpm lint`، و `pnpm test` على كل عملية دفع (Push) وطلب سحب (Pull Request). |
| **CD (النشر المستمر)** | يجب إعداد مسار نشر آلي (Deployment Pipeline) للنشر على بيئة الاستضافة (سيتم تحديدها لاحقًا، ولكن يجب أن يكون الإعداد جاهزًا للنشر على Vercel أو ما شابه). |
